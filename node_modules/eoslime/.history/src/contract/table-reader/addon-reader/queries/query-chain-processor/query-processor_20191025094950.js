import QueryProp from "../query-prop"

class QueryProcessor extends QueryProp {

    private provider: any
    private queryProps: any

    public constructor(provider: any, queryProps: any) {
        super()
        this.provider = provider
        this.queryProps = queryProps
    }

    public async process(): Promise<any> {
        const queryData: any = {}

        for (const queryPropName in this.queryProps) {
            const queryProp: QueryProp = this.queryProps[queryPropName]

            for (const prop in queryProp.props) {
                if (!queryData[prop]) {
                    queryData[prop] = queryProp.props[prop]
                }

                if (queryData[prop] && !queryProp.props.default) {
                    queryData[prop] = queryProp.props[prop]
                }
            }
        }

        return (await this.provider.getTableRows({
            ...queryData,
            json: true
        })).rows
    }
}

export default QueryProcessor
